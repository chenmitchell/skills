---
name: task-workflow-v3
description: æ™ºèƒ½ä»»åŠ¡è°ƒåº¦ç³»ç»Ÿ V3 - æ”¯æŒæ–‡ä»¶æŒä¹…åŒ–ã€è¿›åº¦è¿½è¸ªã€è‡ªåŠ¨å½’æ¡£
author: Galatea
version: "3.0.0"
---

# Task Workflow V3

æ ‡å‡†åŒ–ä»»åŠ¡æ‰§è¡Œæµç¨‹ï¼Œæ”¯æŒä¾èµ–åˆ†æã€å¤æ‚åº¦æ’åºã€åŠ¨æ€ä»»åŠ¡æ’å…¥ã€**æ–‡ä»¶æŒä¹…åŒ–è¿½è¸ª**å’Œ**è‡ªåŠ¨å½’æ¡£**ã€‚

## V3 æ–°ç‰¹æ€§

| ç‰¹æ€§ | V2 | V3 |
|------|-----|-----|
| ä¾èµ–å…³ç³» | âœ… DAG æ‹“æ‰‘æ’åº | âœ… DAG æ‹“æ‰‘æ’åº |
| å¤æ‚åº¦æ’åº | âœ… ä½å¤æ‚åº¦ä¼˜å…ˆ | âœ… ä½å¤æ‚åº¦ä¼˜å…ˆ |
| åŠ¨æ€æ’å…¥ | âœ… æ‰§è¡Œä¸­ä¸ä¸­æ–­ | âœ… æ‰§è¡Œä¸­ä¸ä¸­æ–­ |
| **æ–‡ä»¶æŒä¹…åŒ–** | âŒ | âœ… Markdown è½ç›˜ |
| **è¿›åº¦è¿½è¸ª** | âŒ Session å†… | âœ… æ–‡ä»¶è®°å½• |
| **è‡ªåŠ¨å½’æ¡£** | âŒ | âœ… CST 0ç‚¹è‡ªåŠ¨è¿ç§» |
| **Cron é›†æˆ** | âŒ | âœ… OpenClaw Cron API |

## æ–‡ä»¶è½ç›˜è®¾è®¡

### å­˜å‚¨è·¯å¾„

```
/root/.openclaw/workspace/task_backlog/
â”œâ”€â”€ task-workflow-progress-2026-02-10.md  (æ˜¨æ—¥ - å·²å½’æ¡£)
â”œâ”€â”€ task-workflow-progress-2026-02-11.md  (ä»Šæ—¥ - æ´»è·ƒ)
â””â”€â”€ task-workflow-progress-2026-02-12.md  (æ˜æ—¥ - é¢„åˆ›å»º)
```

### æ–‡ä»¶æ ¼å¼

```markdown
# Task Workflow Progress - 2026-02-11

**Generated**: 2026-02-11T08:00:00  
**Status**: ğŸŸ¢ Active  
**Auto-archive**: CST 00:00 next day

---

## ğŸ“‹ Task List

| ID | Task | Complexity | Dependencies | Status | Batch |
|----|------|-----------|--------------|--------|-------|
| research-a | è°ƒç ”æ–¹æ¡ˆA | 4.2 | - | âœ… Completed | 1 |
| research-b | è°ƒç ”æ–¹æ¡ˆB | 3.0 | - | âœ… Completed | 1 |
| research-c | è°ƒç ”æ–¹æ¡ˆC | 6.0 | - | ğŸ”„ Running | 2 |
| summary | æ±‡æ€»åˆ†æ | 5.0 | research-a, research-b, research-c | â³ Pending | - |

### ğŸ”„ Migrated from Previous Day

| ID | Task | Complexity | Dependencies | Status | Batch |
|----|------|-----------|--------------|--------|-------|
| legacy-task | é—ç•™ä»»åŠ¡ | 3.5 | - | â³ Pending | - |

---

## ğŸ“Š Progress Tracking

| Timestamp | Event | Details |
|-----------|-------|---------|
| 08:00 | File Created | Daily workflow initialized |
| 08:15 | Tasks Scheduled | 4 tasks into 3 batches |
| 08:20 | Task Started | 'è°ƒç ”æ–¹æ¡ˆA' (ID: research-a) |
| 08:45 | Task Completed | 'è°ƒç ”æ–¹æ¡ˆA' (ID: research-a) |
| 09:00 | Task Started | 'è°ƒç ”æ–¹æ¡ˆB' (ID: research-b) |

---

## ğŸ“ˆ Statistics

- **Total Tasks**: 5 (1 migrated)
- **Completed**: 2
- **Running**: 1
- **Pending**: 2
- **Completion Rate**: 40%

---

## âœ… Completion Checklist

- [ ] All tasks completed
- [ ] Progress reviewed
- [ ] File archived

---

*Auto-generated by Task Workflow V3*
```

## è‡ªåŠ¨è¿ç§»æœºåˆ¶

### CST 0:00 è‡ªåŠ¨å¤„ç†

```python
# Cron Job: æ¯å¤© 0:00 æ‰§è¡Œ
0 0 * * * python -m task_workflow_v3.cli init-daily
```

**è¿ç§»é€»è¾‘**:
1. è¯»å–æ˜¨æ—¥æ–‡ä»¶
2. æå– `pending` å’Œ `running` çŠ¶æ€ä»»åŠ¡
3. çŠ¶æ€æ”¹ä¸º `migrated`
4. åœ¨æ–°æ–‡ä»¶ä¸­é‡ç½®ä¸º `pending`
5. ä¿ç•™ `completed` å’Œ `failed` çŠ¶æ€ä¾›å›é¡¾

## å®‰è£…ä¸é…ç½®

### 1. å®‰è£…

```bash
# Skill å·²å®‰è£…åœ¨
cd ~/.openclaw/workspace/skills/task-workflow-v3
```

### 2. é…ç½® Cron ä»»åŠ¡

```bash
# ç”Ÿæˆ cron é…ç½®
python cli.py setup-cron

# è¾“å‡ºç¤ºä¾‹:
âœ… Cron configuration saved to: config/cron.yaml

Generated cron jobs:
  âœ… task-workflow-daily-init: 0 0 * * *
  âœ… task-workflow-cleanup: 0 1 * * *

# OpenClaw Cron API é…ç½®æ ¼å¼:
[
  {
    "name": "task-workflow-daily-init",
    "schedule": "0 0 * * *",
    "command": "python -m task_workflow_v3.cli init-daily",
    "enabled": true
  },
  {
    "name": "task-workflow-cleanup",
    "schedule": "0 1 * * *",
    "command": "python -m task_workflow_v3.cli cleanup --days 30",
    "enabled": true
  }
]
```

### 3. Cron YAML é…ç½®

```yaml
# config/cron.yaml
cron_jobs:
  - name: task-workflow-daily-init
    schedule: '0 0 * * *'
    command: python -m task_workflow_v3.cli init-daily
    description: Initialize daily task workflow file at CST 00:00
    enabled: true
  - name: task-workflow-cleanup
    schedule: '0 1 * * *'
    command: python -m task_workflow_v3.cli cleanup --days 30
    description: Clean up old task files older than 30 days
    enabled: true

settings:
  timezone: Asia/Shanghai
  auto_migrate: true
  retention_days: 30
```

## ä½¿ç”¨æ–¹æ³•

### ç¼–ç¨‹æ¥å£

#### 1. åŸºç¡€è°ƒåº¦ (è‡ªåŠ¨æŒä¹…åŒ–)

```python
from lib.task_scheduler import TaskScheduler, TaskNode

# åˆ›å»ºä»»åŠ¡
tasks = [
    TaskNode(
        id="research",
        name="æŠ€æœ¯è°ƒç ”",
        estimated_time="medium",
        tool_calls_estimate=8
    ),
    TaskNode(
        id="implement",
        name="å®ç°æ–¹æ¡ˆ",
        depends_on=["research"],
        estimated_time="long",
        decision_points=2
    )
]

# è°ƒåº¦ (è‡ªåŠ¨è½ç›˜åˆ° /root/.openclaw/workspace/task_backlog/)
scheduler = TaskScheduler(max_batch_size=10, enable_persistence=True)
batches = scheduler.schedule_tasks(tasks)

print(f"Scheduled into {len(batches)} batches")
```

#### 2. åŠ¨æ€ä»»åŠ¡ç®¡ç†

```python
from lib.task_scheduler import DynamicTaskManager, TaskNode, TaskStatus

manager = DynamicTaskManager(max_batch_size=10, enable_persistence=True)

# åˆå§‹åŒ–
manager.initialize(tasks)

# è·å–æ‰¹æ¬¡
batch = manager.get_next_batch()

# æ ‡è®°çŠ¶æ€
for task in batch:
    manager.mark_running(task.id)
    # ... æ‰§è¡Œä»»åŠ¡ ...
    manager.mark_completed(task.id)

# åŠ¨æ€æ’å…¥
new_task = TaskNode(id="extra", name="é¢å¤–ä»»åŠ¡", depends_on=["research"])
manager.insert_task(new_task)

# æ£€æŸ¥è¿›åº¦
progress = manager.get_progress_summary()
print(f"å®Œæˆç‡: {progress['completion_rate']:.1f}%")
```

#### 3. æ‰‹åŠ¨æŒä¹…åŒ–æ“ä½œ

```python
from lib.task_persistence import TaskPersistenceManager, TaskRecord, TaskStatus

manager = TaskPersistenceManager()

# åˆå§‹åŒ–ä»Šæ—¥æ–‡ä»¶
filepath = manager.initialize_daily_file()

# æ·»åŠ ä»»åŠ¡
task = TaskRecord(
    id="manual-task",
    name="æ‰‹åŠ¨ä»»åŠ¡",
    complexity_score=5.0
)
manager.add_task(task)

# æ›´æ–°çŠ¶æ€
manager.update_task_status("manual-task", TaskStatus.RUNNING)
manager.update_task_status("manual-task", TaskStatus.COMPLETED)

# è®°å½•äº‹ä»¶
manager.log_progress("Custom Event", "Description here")
```

### CLI å‘½ä»¤

```bash
# åˆå§‹åŒ–æ¯æ—¥æ–‡ä»¶
python cli.py init-daily

# åˆ—å‡ºä»Šæ—¥ä»»åŠ¡
python cli.py list

# æ·»åŠ ä»»åŠ¡
python cli.py add task-id "Task Name" --time medium --tools 5

# æ›´æ–°çŠ¶æ€
python cli.py update task-id completed --notes "Done!"

# è®°å½•è¿›åº¦
python cli.py log "Event Name" --details "Description"

# è¿è¡Œæ¼”ç¤º
python cli.py demo

# æ¸…ç†æ—§æ–‡ä»¶ (30å¤©å‰)
python cli.py cleanup --days 30
```

## æ–‡ä»¶ç»“æ„

```
task-workflow-v3/
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ task_scheduler.py      # V3 æ ¸å¿ƒè°ƒåº¦å™¨
â”‚   â””â”€â”€ task_persistence.py    # æŒä¹…åŒ–æ¨¡å— (æ–°å¢)
â”œâ”€â”€ config/
â”‚   â””â”€â”€ cron.yaml              # Cron é…ç½®
â”œâ”€â”€ cli.py                     # å‘½ä»¤è¡Œæ¥å£
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ unit/
â”‚   â”‚   â”œâ”€â”€ test_persistence.py
â”‚   â”‚   â””â”€â”€ test_scheduler.py
â”‚   â””â”€â”€ integration/
â”‚       â””â”€â”€ test_v3_features.py
â”œâ”€â”€ SKILL.md                   # æœ¬æ–‡æ¡£
â””â”€â”€ README.md
```

## æ ¸å¿ƒæ¦‚å¿µ

### ä»»åŠ¡å¤æ‚åº¦ (Complexity)

ç»¼åˆè¯„åˆ† (1-10):
```
å¤æ‚åº¦ = æ—¶é—´åˆ† + å·¥å…·åˆ† + å†³ç­–åˆ†

æ—¶é—´åˆ†: short=1, medium=3, long=5
å·¥å…·åˆ†: min(å·¥å…·æ•°/5, 3)
å†³ç­–åˆ†: å†³ç­–ç‚¹æ•°é‡ Ã— 2
```

### ä¾èµ–å…³ç³» (Dependency)

DAG (æœ‰å‘æ— ç¯å›¾) æ¨¡å‹ï¼š
```yaml
ä»»åŠ¡A:
  depends_on: []           # æ— ä¾èµ–

ä»»åŠ¡B:
  depends_on: ["ä»»åŠ¡A"]     # ä¾èµ– A

ä»»åŠ¡C:
  depends_on: ["ä»»åŠ¡A", "ä»»åŠ¡B"]  # å¤šä¾èµ–
```

### çŠ¶æ€æµè½¬

```
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  PENDING â”‚ (åˆå§‹çŠ¶æ€)
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
         â”‚ start
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ RUNNING â”‚ (æ‰§è¡Œä¸­)
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
    â–¼         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚COMPLETEDâ”‚ â”‚ FAILED â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜

è¿ç§»è·¯å¾„:
PENDING â”€â”€(next day)â”€â”€> MIGRATED â”€â”€(init-daily)â”€â”€> PENDING
```

### è°ƒåº¦ç­–ç•¥

1. **æ‹“æ‰‘æ’åº**: ä¿è¯ä¾èµ–å…ˆæ‰§è¡Œ
2. **å¤æ‚åº¦ä¼˜å…ˆ**: åŒå±‚çº§æŒ‰å¤æ‚åº¦å‡åº
3. **æ‰¹æ¬¡é™åˆ¶**: å•æ‰¹æœ€å¤š 10 ä¸ªä»»åŠ¡
4. **åŠ¨æ€æ’å…¥**: è¿è¡Œä¸­ä»»åŠ¡ä¸ä¸­æ–­

## å¼‚å¸¸å¤„ç†

| åœºæ™¯ | è¡Œä¸º |
|------|------|
| å¾ªç¯ä¾èµ– | æŠ›å‡º `CircularDependencyError` |
| ç¼ºå¤±ä¾èµ– | æŠ›å‡º `ValueError` |
| é‡å¤æ’å…¥ | è¿”å› `False` |
| æ–‡ä»¶è¯»å†™å¤±è´¥ | è®°å½•é”™è¯¯åˆ° stderrï¼Œç»§ç»­æ‰§è¡Œ |

## API å‚è€ƒ

### TaskNode
- `calculate_complexity()` â†’ float: è®¡ç®—å¤æ‚åº¦
- `complexity_score` â†’ float: å¤æ‚åº¦è¯„åˆ† (1-10)
- `update_status(status, notes)` â†’ None: æ›´æ–°çŠ¶æ€å¹¶æŒä¹…åŒ–
- `to_record()` â†’ TaskRecord: è½¬æ¢ä¸ºè®°å½•

### TaskScheduler
- `schedule_tasks(tasks)` â†’ list[list[TaskNode]]: è¿”å›æ‰¹æ¬¡åˆ†ç»„
- `log_event(event, details)` â†’ None: è®°å½•äº‹ä»¶

### DynamicTaskManager
- `initialize(tasks)`: åˆå§‹åŒ–ä»»åŠ¡é˜Ÿåˆ—
- `insert_task(task)` â†’ bool: æ’å…¥æ–°ä»»åŠ¡
- `get_next_batch()` â†’ list[TaskNode]: è·å–å¯æ‰§è¡Œä»»åŠ¡
- `mark_running(task_id)`: æ ‡è®°æ‰§è¡Œä¸­
- `mark_completed(task_id)`: æ ‡è®°å®Œæˆ
- `mark_failed(task_id, reason)`: æ ‡è®°å¤±è´¥
- `get_progress_summary()` â†’ dict: è·å–è¿›åº¦æ‘˜è¦
- `archive_if_complete()`: å¦‚å®Œæˆåˆ™å½’æ¡£

### TaskPersistenceManager
- `initialize_daily_file(date)` â†’ Path: åˆå§‹åŒ–æ¯æ—¥æ–‡ä»¶
- `add_task(record)`: æ·»åŠ ä»»åŠ¡
- `update_task_status(id, status, notes)`: æ›´æ–°çŠ¶æ€
- `log_progress(event, details)`: è®°å½•è¿›åº¦
- `get_current_tasks()` â†’ list[TaskRecord]: è·å–ä»»åŠ¡
- `archive_completed()`: å½’æ¡£æ–‡ä»¶

### CronConfigManager
- `generate_default_config()` â†’ dict: ç”Ÿæˆé»˜è®¤é…ç½®
- `save_config(config)`: ä¿å­˜é…ç½®
- `load_config()` â†’ dict: åŠ è½½é…ç½®
- `get_openclaw_cron_api_payload()` â†’ list: ç”Ÿæˆ API æ ¼å¼

## æµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
cd ~/.openclaw/workspace/skills/task-workflow-v3
pytest tests/ -v

# ä»…å•å…ƒæµ‹è¯•
pytest tests/unit -v

# ä»…é›†æˆæµ‹è¯•
pytest tests/integration -v

# å¸¦è¦†ç›–ç‡
pytest tests/ --cov=lib --cov-report=html
```

## å·¥ä½œåŸç†

```
è¾“å…¥ä»»åŠ¡åˆ—è¡¨
    â†“
æ„å»ºä¾èµ–å›¾ (DAG)
    â†“
æ‹“æ‰‘æ’åº â†’ ç¡®å®šæ‰§è¡Œé¡ºåº
    â†“
æŒ‰å¤æ‚åº¦åˆ†ç»„ â†’ æ‰¹æ¬¡åˆ’åˆ†
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           æŒä¹…åŒ–å±‚ (æ–°å¢)              â”‚
â”‚  â€¢ å†™å…¥ Markdown æ–‡ä»¶                â”‚
â”‚  â€¢ è®°å½•è¿›åº¦äº‹ä»¶                      â”‚
â”‚  â€¢ çŠ¶æ€å˜æ›´åŒæ­¥                      â”‚
â”‚  â€¢ è‡ªåŠ¨è¿ç§»æœºåˆ¶                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
è¾“å‡º: [[æ‰¹æ¬¡1], [æ‰¹æ¬¡2], ...]
    â†“
æ–‡ä»¶è½ç›˜: /root/.openclaw/workspace/task_backlog/task-workflow-progress-YYYY-MM-DD.md
```

## å‡çº§æŒ‡å— (V2 â†’ V3)

### ä»£ç å˜æ›´

```python
# V2
from lib.task_scheduler import TaskScheduler

scheduler = TaskScheduler(max_batch_size=10)
batches = scheduler.schedule_tasks(tasks)

# V3 (å¯ç”¨æŒä¹…åŒ–)
from lib.task_scheduler import TaskScheduler

scheduler = TaskScheduler(max_batch_size=10, enable_persistence=True)
batches = scheduler.schedule_tasks(tasks)  # è‡ªåŠ¨è½ç›˜
```

### é…ç½®è¿ç§»

```bash
# ç”Ÿæˆ V3 é…ç½®æ–‡ä»¶
python cli.py setup-cron

# æ‰‹åŠ¨å¤åˆ¶åˆ° OpenClaw é…ç½®
# ~/.openclaw/config/cron.json
```

---

*Workflow Version: 3.0.0*  
*Last Updated: 2026-02-11*
