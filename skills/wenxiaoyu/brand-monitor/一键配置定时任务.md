# 一键配置品牌舆情监控定时任务

## 🚀 最简单的方法

### 方法 1：对话配置（推荐）

直接在 Telegram/WhatsApp 对 OpenClaw 说：

```
请帮我配置品牌舆情监控定时任务：

任务1：每日监控
- 时间：每天早上 9:00
- 任务：执行 brand-monitor skill 的 monitor 提示词
- 推送：发送报告到飞书

任务2：实时警报
- 时间：每小时
- 任务：执行 brand-monitor skill 的 alert 提示词
- 推送：仅在有警报时发送到飞书

任务3：周报分析
- 时间：每周一早上 10:00
- 任务：执行 brand-monitor skill 的 analyze-trend 提示词，分析过去7天
- 推送：发送报告到飞书

请立即创建这些定时任务，并告诉我设置结果。
```

**OpenClaw 会自动：**
1. ✅ 创建 3 个 cron 任务
2. ✅ 配置执行时间
3. ✅ 设置飞书推送
4. ✅ 启用任务
5. ✅ 返回确认信息

---

## 📝 方法 2：配置文件（精确控制）

### 步骤 1：编辑 OpenClaw 配置

```bash
nano ~/.openclaw/openclaw.json
```

### 步骤 2：找到 cron 部分

如果没有 `cron` 部分，添加以下内容：

```json
{
  "cron": {
    "enabled": true,
    "timezone": "Asia/Shanghai",
    "jobs": []
  }
}
```

### 步骤 3：添加任务配置

在 `jobs` 数组中添加：

```json
{
  "cron": {
    "enabled": true,
    "timezone": "Asia/Shanghai",
    "jobs": [
      {
        "id": "brand-monitor-daily",
        "name": "品牌舆情监控-每日",
        "description": "每天早上9点执行品牌监控，搜索各平台提及并分析",
        "schedule": "0 9 * * *",
        "enabled": true,
        "action": {
          "type": "prompt",
          "content": "执行品牌监控：\n1. 搜索小红书、微博、汽车之家、懂车帝、易车网、知乎、百度贴吧、抖音等平台\n2. 分析情感和影响力\n3. 特别关注汽车媒体大V的评测\n4. 生成报告并发送到飞书"
        }
      },
      {
        "id": "brand-monitor-alert",
        "name": "品牌舆情监控-警报",
        "description": "每小时检查紧急警报",
        "schedule": "0 * * * *",
        "enabled": true,
        "action": {
          "type": "prompt",
          "content": "检查品牌警报：\n1. 搜索过去1小时的最新提及\n2. 检测负面提及（情感<-0.5，影响力>100）\n3. 检测病毒式传播（互动>5000）\n4. 如有紧急情况，立即推送到飞书"
        }
      },
      {
        "id": "brand-monitor-weekly",
        "name": "品牌舆情监控-周报",
        "description": "每周一早上10点生成周报",
        "schedule": "0 10 * * 1",
        "enabled": true,
        "action": {
          "type": "prompt",
          "content": "生成品牌舆情周报：\n1. 分析过去7天的监控数据\n2. 提及数量趋势\n3. 情感变化趋势\n4. 热门话题分析\n5. 关键洞察和建议\n6. 发送报告到飞书"
        }
      }
    ]
  }
}
```

### 步骤 4：保存并重启

```bash
# 保存文件
Ctrl + O
Enter
Ctrl + X

# 重启 OpenClaw
openclaw restart

# 等待10秒
sleep 10

# 验证任务
openclaw cron list
```

---

## ✅ 验证配置

### 1. 查看任务列表

```bash
openclaw cron list
```

**预期输出：**
```
✓ brand-monitor-daily
  每天 09:00 | 品牌舆情监控-每日
  
✓ brand-monitor-alert
  每小时 | 品牌舆情监控-警报
  
✓ brand-monitor-weekly
  每周一 10:00 | 品牌舆情监控-周报
```

### 2. 手动触发测试

```bash
# 测试每日监控
openclaw cron trigger brand-monitor-daily
```

或直接对 OpenClaw 说：

```
立即执行品牌监控任务
```

### 3. 查看执行日志

```bash
# 实时查看日志
tail -f ~/.openclaw/logs/cron.log

# 查看最近50行
tail -n 50 ~/.openclaw/logs/cron.log
```

### 4. 检查飞书消息

3-5 分钟后，检查飞书是否收到报告。

---

## 🎯 定时任务说明

### 任务 1：每日监控

**执行时间：** 每天早上 9:00

**任务内容：**
1. 搜索所有配置的平台（小红书、微博、汽车之家等）
2. 获取过去 24 小时的品牌提及
3. 分析每条提及的情感和影响力
4. 识别汽车媒体大V的内容
5. 生成结构化报告
6. 推送到飞书

**报告包含：**
- 总览统计
- 热门提及 Top 5
- 平台分布
- 热门话题
- 需要关注的内容
- 关键洞察
- 建议行动

### 任务 2：实时警报

**执行时间：** 每小时（整点）

**任务内容：**
1. 搜索过去 1 小时的最新提及
2. 快速筛选需要关注的内容
3. 检测负面提及
4. 检测病毒式传播
5. 评估紧急程度
6. 仅在有警报时推送到飞书

**警报条件：**
- 负面提及：情感 < -0.5 且影响力 > 100
- 病毒式传播：互动数 > 5000
- 危机信号：包含"安全"、"召回"、"事故"等关键词

### 任务 3：周报分析

**执行时间：** 每周一早上 10:00

**任务内容：**
1. 从记忆中读取过去 7 天的数据
2. 分析提及数量趋势
3. 分析情感变化趋势
4. 识别热门话题
5. 提取关键洞察
6. 生成战略建议
7. 推送到飞书

**周报包含：**
- 周度数据对比
- 趋势图表
- 热门话题演变
- 关键影响者
- 战略建议

---

## ⚙️ 自定义配置

### 调整执行时间

修改 `schedule` 字段：

```json
{
  "schedule": "0 9 * * *"  // 每天 9:00
}
```

**Cron 格式：**
```
分 时 日 月 周
│ │ │ │ │
│ │ │ │ └─ 0-7 (0和7都是周日)
│ │ │ └─── 1-12
│ │ └───── 1-31
│ └─────── 0-23
└───────── 0-59
```

**常用示例：**
- `0 9 * * *` - 每天 9:00
- `0 */2 * * *` - 每 2 小时
- `0 9,18 * * *` - 每天 9:00 和 18:00
- `0 9 * * 1-5` - 工作日 9:00
- `0 9 1 * *` - 每月 1 号 9:00

### 调整监控频率

**新车发布期（密集监控）：**
```json
{
  "schedule": "0 */2 * * *"  // 每 2 小时
}
```

**日常监控：**
```json
{
  "schedule": "0 9 * * *"  // 每天一次
}
```

**危机期（超密集监控）：**
```json
{
  "schedule": "*/30 * * * *"  // 每 30 分钟
}
```

### 禁用某个任务

```json
{
  "enabled": false  // 改为 false
}
```

### 添加更多任务

**月报任务：**
```json
{
  "id": "brand-monitor-monthly",
  "name": "品牌舆情监控-月报",
  "schedule": "0 10 1 * *",
  "enabled": true,
  "action": {
    "type": "prompt",
    "content": "生成品牌舆情月报，分析过去30天的数据"
  }
}
```

**竞品对比任务：**
```json
{
  "id": "competitor-analysis",
  "name": "竞品分析",
  "schedule": "0 10 * * 1",
  "enabled": true,
  "action": {
    "type": "prompt",
    "content": "同时监控我的品牌和竞品A、竞品B，生成对比分析报告"
  }
}
```

---

## 🐛 故障排查

### 问题 1：任务未执行

**检查任务状态：**
```bash
openclaw cron list
```

**查看日志：**
```bash
tail -f ~/.openclaw/logs/cron.log
```

**手动触发：**
```bash
openclaw cron trigger brand-monitor-daily
```

### 问题 2：飞书未收到消息

**测试飞书集成：**
```bash
openclaw message send --channel=feishu --text="测试消息"
```

**检查配置：**
```bash
openclaw config show | grep feishu
```

### 问题 3：任务执行失败

**查看错误日志：**
```bash
tail -n 100 ~/.openclaw/logs/cron.log | grep ERROR
```

**检查 OpenClaw 状态：**
```bash
openclaw doctor
```

### 问题 4：时区不对

**设置时区：**
```json
{
  "cron": {
    "timezone": "Asia/Shanghai"
  }
}
```

**验证时区：**
```bash
date
timedatectl
```

---

## 📊 监控任务执行

### 查看执行历史

```bash
# 查看今天的执行记录
openclaw cron history --today

# 查看最近10次执行
openclaw cron history --limit=10

# 查看特定任务的历史
openclaw cron history --job=brand-monitor-daily
```

### 查看下次执行时间

```bash
openclaw cron next
```

**预期输出：**
```
brand-monitor-alert: 下次执行 2026-02-25 15:00
brand-monitor-daily: 下次执行 2026-02-26 09:00
brand-monitor-weekly: 下次执行 2026-03-03 10:00
```

### 设置执行通知

```json
{
  "notification": {
    "channel": "feishu",
    "on_success": true,   // 成功时通知
    "on_failure": true    // 失败时通知
  }
}
```

---

## ✅ 完成检查清单

配置完成后，确认以下项目：

- [ ] 定时任务已添加到配置文件
- [ ] OpenClaw 已重启
- [ ] `openclaw cron list` 显示所有任务
- [ ] 所有任务状态为 `enabled: true`
- [ ] 手动触发测试成功
- [ ] 飞书收到测试报告
- [ ] 日志中无错误信息
- [ ] 下次执行时间正确

---

## 🎉 完成！

现在你的品牌舆情监控系统已经完全自动化了！

**系统会自动：**
- ✅ 每天早上 9:00 推送监控报告
- ✅ 每小时检查紧急警报
- ✅ 每周一早上 10:00 推送周报
- ✅ 所有报告自动发送到飞书

**你只需要：**
- 📱 每天查看飞书报告
- ⚠️ 及时处理警报
- 📊 每周查看趋势分析
- 🎯 根据洞察优化策略

---

**祝你的品牌舆情监控顺利运行！** 🚀
