# OpenClaw 品牌监控 Skill - 完整部署指南

## 📋 目录

1. [系统要求](#系统要求)
2. [飞书配置](#飞书配置)
3. [Skill 安装](#skill-安装)
4. [配置说明](#配置说明)
5. [使用方法](#使用方法)
6. [定时任务](#定时任务)
7. [故障排查](#故障排查)

---

## 系统要求

### 必需条件

- ✅ OpenClaw 已安装并运行（v2026.2.0+）
- ✅ OpenClaw 已配置 LLM（Claude/GPT/Gemini）
- ✅ OpenClaw 已启用以下工具：
  - `web_search`
  - `web_fetch`
  - `message`
  - `memory_search`
  - `memory_get`

### 验证 OpenClaw 状态

```bash
# 检查 OpenClaw 健康状态
openclaw doctor

# 检查已启用的工具
openclaw config show | grep tools

# 检查 LLM 配置
openclaw config show | grep llm
```

预期输出：
```
✓ OpenClaw v2026.2.6
✓ LLM: Claude 3.5 Sonnet
✓ Tools: web_search, web_fetch, message, memory_search, memory_get
```

---

## 飞书配置

### 第一步：创建飞书机器人

1. **打开飞书管理后台**
   - 访问：https://open.feishu.cn/
   - 登录你的飞书账号

2. **创建企业自建应用**
   - 点击"创建企业自建应用"
   - 应用名称：`品牌监控机器人`
   - 应用描述：`自动监控品牌在各平台的提及情况`
   - 上传应用图标（可选）

3. **获取凭证**
   - 进入应用详情页
   - 记录 `App ID` 和 `App Secret`

4. **添加机器人能力**
   - 点击"添加应用能力"
   - 选择"机器人"
   - 配置机器人信息

5. **配置权限**
   - 进入"权限管理"
   - 添加以下权限：
     - `im:message` - 发送消息
     - `im:message:send_as_bot` - 以机器人身份发送
   - 点击"发布版本"

### 第二步：创建 Webhook

**方式 A：群聊机器人（推荐）**

1. 打开飞书群聊
2. 点击右上角"..."
3. 选择"设置" → "群机器人"
4. 点击"添加机器人"
5. 选择"自定义机器人"
6. 机器人名称：`品牌监控`
7. 复制 Webhook 地址（格式：`https://open.feishu.cn/open-apis/bot/v2/hook/...`）

**方式 B：个人机器人**

1. 在飞书中搜索你创建的机器人
2. 发送消息测试
3. 使用 App ID 和 App Secret 配置

### 第三步：测试 Webhook

```bash
# 测试发送消息
curl -X POST "你的Webhook地址" \
  -H "Content-Type: application/json" \
  -d '{
    "msg_type": "text",
    "content": {
      "text": "测试消息：品牌监控机器人已连接"
    }
  }'
```

如果收到消息，说明配置成功！

---

## Skill 安装

### 第一步：下载 Skill

```bash
# 方式 A：从 Git 克隆
cd ~
git clone https://github.com/your-repo/brand-monitor-skill.git
cd brand-monitor-skill

# 方式 B：手动下载
# 下载 ZIP 并解压到本地
```

### 第二步：安装到 OpenClaw（只复制必需文件）

```bash
# 创建目标目录
mkdir -p ~/.openclaw/skills/brand-monitor/prompts

# 只复制必需的文件
cp SKILL.md ~/.openclaw/skills/brand-monitor/
cp config.example.json ~/.openclaw/skills/brand-monitor/
cp prompts/monitor.md ~/.openclaw/skills/brand-monitor/prompts/
cp prompts/alert.md ~/.openclaw/skills/brand-monitor/prompts/
cp prompts/analyze-trend.md ~/.openclaw/skills/brand-monitor/prompts/

# 验证安装
ls -la ~/.openclaw/skills/brand-monitor
```

预期输出：
```
SKILL.md              # Skill 元数据和文档（符合 AgentSkills 规范）
config.example.json   # 配置示例
prompts/              # 提示词目录
  monitor.md          # 每日监控
  alert.md            # 实时警报
  analyze-trend.md    # 趋势分析
```

**注意：** 文档文件（README.md、部署指南.md 等）不需要复制到 OpenClaw，它们只是供用户参考。

### 第三步：重启 OpenClaw

```bash
# 重启 OpenClaw 以加载新 Skill
openclaw restart

# 或者重新加载 Skills
openclaw skills reload
```

### 第四步：验证安装

```bash
# 列出所有 Skills
openclaw skills list

# 查看 brand-monitor Skill 详情
openclaw skills show brand-monitor
```

预期输出：
```
✓ brand-monitor v1.1.0
  新能源汽车品牌舆情监控
  Allowed tools: web_search, web_fetch, message
  Prompts: monitor, analyze-trend, alert
  Status: Active
```

**注意：** 此 skill 符合 AgentSkills 规范，使用 SKILL.md 格式而非 JSON。

---

## 配置说明

### 创建配置文件

在 `~/.openclaw/skills/brand-monitor/` 目录下创建 `config.json`：

```bash
cd ~/.openclaw/skills/brand-monitor
nano config.json
```

### 基础配置模板

```json
{
  "brand_name": "你的品牌名",
  "brand_aliases": [
    "车型1",
    "车型2",
    "英文名"
  ],
  "exclude_keywords": [
    "招聘",
    "代理",
    "二手车",
    "推广"
  ],
  "platforms": [
    "xiaohongshu",
    "weibo",
    "autohome",
    "dongchedi",
    "yiche",
    "zhihu",
    "tieba",
    "douyin"
  ],
  "monitor_hours": 24,
  "min_engagement": 10,
  "negative_threshold": -0.5,
  "viral_threshold": 5000,
  "feishu_webhook": "https://open.feishu.cn/open-apis/bot/v2/hook/你的Webhook",
  "report_language": "zh-CN",
  
  "industry_specific": {
    "focus_keywords": [
      "续航", "充电", "智能驾驶", "辅助驾驶",
      "电池", "安全", "空间", "舒适性"
    ],
    "kol_min_followers": 100000,
    "media_accounts": [
      "汽车之家", "懂车帝", "易车网",
      "新出行", "电动邦", "42号车库"
    ]
  }
}
```

### 配置项说明

| 配置项 | 类型 | 说明 | 默认值 |
|--------|------|------|--------|
| `brand_name` | string | 品牌名称（必填） | - |
| `brand_aliases` | array | 品牌别名列表 | [] |
| `exclude_keywords` | array | 排除关键词 | ["spam", "广告"] |
| `platforms` | array | 监控平台 | ["xiaohongshu", "weibo", "autohome", "dongchedi", "yiche", "zhihu", "tieba", "douyin"] |
| `monitor_hours` | number | 监控时间范围（小时） | 24 |
| `min_engagement` | number | 最小互动数阈值 | 10 |
| `negative_threshold` | number | 负面情感阈值 | -0.5 |
| `viral_threshold` | number | 病毒式传播阈值 | 5000 |
| `industry_specific` | object | 行业定制配置 | {} |
| `feishu_webhook` | string | 飞书 Webhook URL（必填） | - |
| `report_language` | string | 报告语言 | "zh-CN" |

### 高级配置（可选）

```json
{
  "brand_name": "你的品牌",
  "feishu_webhook": "你的Webhook",
  
  "advanced": {
    "search_depth": "deep",
    "sentiment_model": "claude-3-5-sonnet",
    "batch_size": 10,
    "cache_ttl": 3600,
    "retry_attempts": 3,
    "timeout": 30000
  },
  
  "alerts": {
    "enabled": true,
    "check_interval": 60,
    "notification_channels": ["feishu", "email"],
    "severity_levels": {
      "crisis": 5,
      "severe": 4,
      "moderate": 3,
      "minor": 2,
      "info": 1
    }
  },
  
  "reporting": {
    "daily_time": "09:00",
    "weekly_day": "monday",
    "monthly_date": 1,
    "include_charts": true,
    "max_mentions": 20
  }
}
```

### 保存配置

```bash
# 保存并退出 nano
Ctrl + O (保存)
Enter (确认)
Ctrl + X (退出)

# 验证配置文件格式
cat config.json | jq
```

---

## 使用方法

### 方式 1：通过 Telegram/WhatsApp 对话

在 OpenClaw 的聊天界面中发送：

#### 执行每日监控

```
执行品牌监控
```

或

```
@openclaw 运行 brand-monitor 的 monitor 任务
```

#### 分析趋势

```
分析品牌趋势
```

或

```
@openclaw 运行 brand-monitor 的 analyze-trend 任务，分析过去7天
```

#### 检查警报

```
检查品牌警报
```

或

```
@openclaw 运行 brand-monitor 的 alert 任务
```

### 方式 2：通过 OpenClaw CLI

```bash
# 执行每日监控
openclaw skill run brand-monitor monitor

# 分析趋势（过去7天）
openclaw skill run brand-monitor analyze-trend --days=7

# 检查警报（过去1小时）
openclaw skill run brand-monitor alert --hours=1
```

### 方式 3：通过 OpenClaw API

```bash
# 使用 curl 调用
curl -X POST http://localhost:18789/api/skills/brand-monitor/run \
  -H "Content-Type: application/json" \
  -d '{
    "prompt": "monitor",
    "variables": {}
  }'
```

---

## 定时任务

### 方式 1：使用 OpenClaw Cron（推荐）

#### 在 Telegram/WhatsApp 中设置

发送给 OpenClaw：

```
请帮我设置定时任务：

1. 每天早上 9:00 执行品牌监控
   任务: brand-monitor 的 monitor

2. 每小时检查一次警报
   任务: brand-monitor 的 alert

3. 每周一早上 10:00 生成趋势分析
   任务: brand-monitor 的 analyze-trend，分析过去7天

请立即设置这些定时任务。
```

#### 通过配置文件设置

编辑 `~/.openclaw/openclaw.json`：

```json
{
  "cron": {
    "jobs": [
      {
        "name": "品牌监控-每日",
        "schedule": "0 9 * * *",
        "skill": "brand-monitor",
        "prompt": "monitor",
        "enabled": true
      },
      {
        "name": "品牌监控-警报",
        "schedule": "0 * * * *",
        "skill": "brand-monitor",
        "prompt": "alert",
        "variables": {
          "alert_hours": 1
        },
        "enabled": true
      },
      {
        "name": "品牌监控-周报",
        "schedule": "0 10 * * 1",
        "skill": "brand-monitor",
        "prompt": "analyze-trend",
        "variables": {
          "days": 7
        },
        "enabled": true
      }
    ]
  }
}
```

### 方式 2：使用系统 Cron

```bash
# 编辑 crontab
crontab -e

# 添加以下任务
# 每天早上 9:00 执行监控
0 9 * * * openclaw skill run brand-monitor monitor

# 每小时检查警报
0 * * * * openclaw skill run brand-monitor alert --hours=1

# 每周一早上 10:00 生成周报
0 10 * * 1 openclaw skill run brand-monitor analyze-trend --days=7
```

### Cron 时间格式说明

```
* * * * *
│ │ │ │ │
│ │ │ │ └─ 星期 (0-7, 0和7都表示周日)
│ │ │ └─── 月份 (1-12)
│ │ └───── 日期 (1-31)
│ └─────── 小时 (0-23)
└───────── 分钟 (0-59)
```

**常用示例：**
- `0 9 * * *` - 每天早上 9:00
- `0 */6 * * *` - 每 6 小时
- `0 9 * * 1` - 每周一早上 9:00
- `0 9 1 * *` - 每月 1 号早上 9:00

### 验证定时任务

```bash
# 查看 OpenClaw cron 任务
openclaw cron list

# 查看系统 cron 任务
crontab -l

# 查看 cron 执行日志
tail -f ~/.openclaw/logs/cron.log
```

---

## 故障排查

### 问题 1：Skill 未加载

**症状：**
```bash
openclaw skills list
# brand-monitor 不在列表中
```

**解决方案：**

```bash
# 1. 检查 Skill 目录
ls -la ~/.openclaw/skills/brand-monitor

# 2. 检查 skill.json 格式
cat ~/.openclaw/skills/brand-monitor/skill.json | jq

# 3. 查看 OpenClaw 日志
tail -f ~/.openclaw/logs/gateway.log | grep brand-monitor

# 4. 重新加载 Skills
openclaw skills reload

# 5. 重启 OpenClaw
openclaw restart
```

### 问题 2：飞书未收到消息

**症状：**
监控执行成功，但飞书没有收到报告

**解决方案：**

```bash
# 1. 测试 Webhook
curl -X POST "你的Webhook地址" \
  -H "Content-Type: application/json" \
  -d '{"msg_type":"text","content":{"text":"测试"}}'

# 2. 检查配置文件
cat ~/.openclaw/skills/brand-monitor/config.json | grep feishu_webhook

# 3. 查看 OpenClaw 日志
tail -f ~/.openclaw/logs/gateway.log | grep feishu

# 4. 验证 message 工具已启用
openclaw config show | grep message
```

### 问题 3：搜索无结果

**症状：**
执行监控后报告显示 0 条提及

**解决方案：**

```bash
# 1. 手动测试搜索
openclaw chat "搜索 '你的品牌名' site:twitter.com"

# 2. 检查品牌名称配置
cat ~/.openclaw/skills/brand-monitor/config.json | grep brand_name

# 3. 尝试更通用的关键词
# 编辑 config.json，添加更多别名

# 4. 检查 web_search 工具
openclaw tools test web_search --query="你的品牌名"
```

### 问题 4：情感分析不准确

**症状：**
明显正面的提及被标记为负面

**解决方案：**

```bash
# 1. 检查 LLM 配置
openclaw config show | grep llm

# 2. 尝试更强大的模型
# 编辑 ~/.openclaw/openclaw.json
# 将模型改为 claude-3-5-sonnet 或 gpt-4

# 3. 调整情感阈值
# 编辑 config.json
# 将 negative_threshold 从 -0.5 改为 -0.7

# 4. 查看具体分析过程
openclaw skill run brand-monitor monitor --verbose
```

### 问题 5：定时任务未执行

**症状：**
设置了 cron 但没有自动执行

**解决方案：**

```bash
# 1. 检查 cron 配置
openclaw cron list

# 2. 查看 cron 日志
tail -f ~/.openclaw/logs/cron.log

# 3. 手动触发测试
openclaw cron trigger "品牌监控-每日"

# 4. 检查 OpenClaw 是否运行
ps aux | grep openclaw

# 5. 重启 OpenClaw
openclaw restart
```

### 问题 6：内存占用过高

**症状：**
OpenClaw 内存使用持续增长

**解决方案：**

```bash
# 1. 清理旧的监控数据
openclaw memory clean --older-than=30d --type=brand_monitor_report

# 2. 减少批处理大小
# 编辑 config.json
# 添加 "batch_size": 5

# 3. 限制搜索结果数
# 编辑 prompts/monitor.md
# 减少每个平台的搜索数量

# 4. 重启 OpenClaw
openclaw restart
```

### 获取帮助

如果以上方法都无法解决问题：

1. **查看完整日志**
   ```bash
   tail -n 200 ~/.openclaw/logs/gateway.log
   ```

2. **启用调试模式**
   ```bash
   openclaw config set log_level debug
   openclaw restart
   ```

3. **导出诊断信息**
   ```bash
   openclaw doctor --export > diagnosis.txt
   ```

4. **联系支持**
   - GitHub Issues: https://github.com/your-repo/issues
   - 社区论坛: https://community.openclaw.ai
   - 邮件: support@openclaw.ai

---

## 下一步

✅ Skill 已安装并配置
✅ 飞书机器人已连接
✅ 定时任务已设置

**现在可以：**

1. 手动执行一次测试
   ```
   openclaw skill run brand-monitor monitor
   ```

2. 等待第一份定时报告（明天早上 9:00）

3. 查看飞书群聊中的报告

4. 根据需要调整配置

**推荐阅读：**
- `使用指南.md` - 详细使用说明
- `最佳实践.md` - 优化建议
- `API文档.md` - 高级集成

祝你使用愉快！🎉
